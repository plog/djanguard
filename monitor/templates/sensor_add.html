{% extends "monitor_base.html" %}
{% load static %}
{% load form_tags %}
{% block content %}
<h1>Add New Sensor</h1>
        
<!-- Form to add new Sensor -->
<form id="sensor-create-form" class="mb-5">
    <div class="mb-3">
        <label for="name" class="form-label">Sensor Name:</label><span class="require">*</span>
        <input type="text" onkeypress="return onlyAlphaNumericKey(event)" id="name" name="name" class="form-control" required>
    </div>
    <div class="mb-3">
        <label for="url" class="form-label">Base URL:</label><span class="require">*</span>
        <input type="url" id="url" name="url" class="form-control" required>
    </div>
    <div class="mb-3">
        <label for="frequency" class="form-label">Frequency (minutes):</label><span class="require">*</span>
        <input type="number" onkeypress="return onlyNumberKey(event)" id="frequency" name="frequency" class="form-control">
    </div>
    <button type="button" id="create-sensor" class="btn btn-primary">Create Sensor</button>
</form>
</div>

<script>
const user = {{request.user.id}};
$(document).ready(function() {
    
    // Create new Sensor
    $('#create-sensor').click(function() {
        // Client-side validation
        const name        = $('#name').val();
        const url         = $('#url').val();
        const frequency   = $('#frequency').val();

        if(!isUrlValid(url)){
            alert('Not a valid URL');
            return;
        }
        if (!name  || !frequency || !user) {
            alert('Please fill in all required fields before saving.');
            return;
        }

        const data = {name:name,url:url,frequency:frequency,user: user};
        $.ajax({
            url: '/api/sensor/',
            method: 'POST',
            contentType: 'application/json',
            headers: {'X-CSRFToken': Cookies.get('csrftoken')},
            data: JSON.stringify(data),
            success: function(response) {
                window.location.href = '/board/';
            },
            error: function(error) {
                console.error('Error creating sensor:', error);
                alert('Failed to create sensor.');
            }
        });
    });
});
</script>
{% endblock %}
